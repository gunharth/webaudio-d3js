<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>

<body>

    <audio id="audioElement" src="./audio/guni.ogg"></audio>
    <div>
        <button onclick="document.getElementById('audioElement').play()">Play the Audio</button>
        <button onclick="document.getElementById('audioElement').pause()">Pause the Audio</button>
        <button onclick="document.getElementById('audioElement').volume+=0.1">Increase Volume</button>
        <button onclick="document.getElementById('audioElement').volume-=0.1">Decrease Volume</button>
    </div>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/d3/5.7.0/d3.min.js"></script>
    <script>
        $(document).ready(function () {

            var audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            var audioElement = document.getElementById('audioElement');
            var audioSrc = audioCtx.createMediaElementSource(audioElement);
            var analyser = audioCtx.createAnalyser();

            // Bind our analyser to the media element source.
            audioSrc.connect(analyser);
            audioSrc.connect(audioCtx.destination);

            var frequencyData = new Uint8Array(200);

            var svgHeight = 300;
            var svgWidth = $(window).width();;
            var barPadding = 1;

            function createSvg(parent, height, width) {
                return d3.select(parent)
                    .append('svg')
                    .attr('height', height)
                    .attr('width', width);
            }

            // var graph = createSvg('#graph', svgHeight, svgWidth);
            var svg = createSvg('body', svgHeight, svgWidth);

            // var dataset = [12, 19, 8, 17, 22, 9, 15, 12, 22, 25, 17, 12, 25, 16];

            svg.selectAll('rect')
                .data(frequencyData)
                .enter()
                .append('rect')
                .attr('x', function (d, i) {
                    return i * (svgWidth / frequencyData.length);
                })
                .attr('width', svgWidth / frequencyData.length - barPadding);

            // Continuously loop and update chart with frequency data.
            function renderChart() {
                requestAnimationFrame(renderChart);

                // Copy frequency data to frequencyData array.
                analyser.getByteFrequencyData(frequencyData);
                console.log(frequencyData)

                // Update d3 chart with new data.
                svg.selectAll('rect')
                    .data(frequencyData)
                    .attr('y', function (d) {
                        return svgHeight - d;
                    })
                    .attr('height', function (d) {
                        return d;
                    })
                    .attr('fill', function (d) {
                        return 'rgb(' + d + ', 40, 50)';
                    });
            }

            // Run the loop
            renderChart();

        });


    </script>
</body>

</html>
